"""
{{ domain_class_name }} Domain Adapter.

Registers {{ domain_name }}-specific ontology to the framework.
"""
import logging
from typing import Dict, List, Any, Optional, TYPE_CHECKING

if TYPE_CHECKING:
    from core.ontology.registry import OntologyRegistry
    from sqlalchemy.orm import Session

from core.ontology.domain_adapter import IDomainAdapter
from core.ontology.metadata import EntityMetadata, PropertyMetadata

logger = logging.getLogger(__name__)


class {{ domain_class_name }}DomainAdapter(IDomainAdapter):
    """{{ domain_display_name }} domain adapter â€” registers entities into OntologyRegistry."""

    def __init__(self, db: "Session" = None):
        self._db = db

    def get_domain_name(self) -> str:
        return "{{ domain_display_name }}"

    def register_ontology(self, registry: "OntologyRegistry") -> None:
        """Register domain ontology."""
        self._register_models(registry)
        # TODO: Register entities, state machines, constraints, relationships

    def _register_models(self, registry: "OntologyRegistry") -> None:
        """Register ORM model classes."""
        from app.{{ domain_name }}.models.ontology import Employee
        registry.register_model("Employee", Employee)
        # TODO: Register your domain models here

    def get_current_state(self) -> Dict[str, Any]:
        return {}

    def execute_action(self, action_type: str, params: Dict[str, Any], context: Dict[str, Any]) -> Dict[str, Any]:
        from app.services.actions import get_action_registry
        action_registry = get_action_registry()
        try:
            return action_registry.dispatch(action_type, params, context)
        except Exception as e:
            return {"success": False, "error": str(e), "action_type": action_type}

    def get_llm_system_prompt_additions(self) -> str:
        return ""

    def get_entity_display_name(self, entity_type: str, entity_id: Any) -> str:
        return f"{entity_type}:{entity_id}"

    def build_llm_context(self, db) -> Dict[str, Any]:
        # TODO: Build domain-specific LLM context
        return {}

    def enhance_action_params(self, action_type: str, params: Dict[str, Any], message: str, db) -> Dict[str, Any]:
        # TODO: Enhance LLM-extracted params with domain DB lookups
        return params

    def enhance_single_action_params(self, action_type: str, params: Dict[str, Any], db) -> Dict[str, Any]:
        return params.copy()

    def get_field_definition(self, param_name: str, action_type: str, current_params: Dict[str, Any], db) -> Optional[Any]:
        # TODO: Provide UI field definitions for missing parameters
        return None

    def get_report_data(self, db) -> Dict[str, Any]:
        return {"message": "No reports configured yet.", "stats": {}}

    def get_help_text(self, language: str = "zh") -> str:
        return "Welcome! This is the {{ domain_display_name }} assistant."

    def get_display_names(self) -> Dict[str, str]:
        # TODO: Map field names to display names
        return {}

    def get_admin_roles(self) -> List[str]:
        return ["sysadmin", "manager"]

    def get_query_examples(self) -> List[Dict[str, Any]]:
        return []

    def get_context_summary(self, db, additional_context: Dict[str, Any]) -> List[str]:
        return []

    def get_hitl_risk_overrides(self) -> Dict[str, Any]:
        return {}

    def get_hitl_custom_rules(self) -> list:
        return []
